<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<title>门店管理系统-运营日报</title>
	<link rel="shortcut icon" type="image/x-icon" href="../icon.png"/>
	<link href="style.css" rel="stylesheet" media="all" />
	<link href="" rel="stylesheet" title="style" media="all" />
    <link href="../startbootstrap/bower_components/bootstrap/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        .box-body img{width: 100%}
        .report{font-size: 16px;background-color: #a93f31;color: #fff; padding-bottom: 20px;}
        .report .box-header{color: #fff;}
        .report em{width: 70px; position: absolute; right: 0; bottom: 0;}
        .report img{height: 100%;}
        .report li{float:left; line-height: 28px; color: #f8e7e5; margin-top: 5px;}
        .report i{margin-right: 5px; opacity: 0.6;}
        .report span{font-size: 24px; color: #ffb959; font-weight: bold;}
        .report p i{color: #fff;}
        .report p small{font-size: 16px;}
        .report p:nth-child(2),.report p:nth-child(2n){font-size: 18px; margin: 10px 0 5px 0; color: rgba(255,255,255,0.7);}
        .report p:nth-child(2n+1){font-size: 34px; padding-left: 20px;}
        .report dt{border-bottom: 1px dashed rgba(255,255,255,1); padding: 0 5px 5px 5px; position: relative; margin: 0 10px;}
        .report dt:after{content: ''; width: 7px; height: 8px; background-color: rgba(255,255,255,.8); border-radius: 50%; position: absolute; bottom: -5px; left: -7px;}
        .report dt:before{content: ''; width: 7px; height: 8px; background-color: rgba(255,255,255,.8); border-radius: 50%; position: absolute; bottom: -5px; right: -7px;}
        .report_jr li{width: 23%; background-color: rgba(0,0,0,0.2); box-shadow: 0 1px 1px rgba(0,0,0,1); border-radius: 5px; margin: 15px 1% 0 1%; padding: 15px 0; line-height: 30px;}
        .report_jr li i{font-size: 50px; color: rgba(255, 255, 255, 0.4); padding-top: 5px;}
        .report_jr li span{font-size: 22px; color: #ffde00;}

        .vertical-example{
            position: absolute;
            top: 140px;
            right: 5px;
            width: 70px;}
        .navimenu{min-height: 800px;width: 70px; padding-top: 0;}
        #gooey-v .open-button, #gooey-v .gooey-menu-item{margin-top: 0; margin-bottom: 15em;}
        #process_div{
            background-color:#292a2b;
            display:inline;
            z-index:100000;
            left:0px;
            opacity:0.3; top:0; left:0;height:100%; width:100%; z-index:999; position:fixed; _position:absolute; _left: expression_r(documentElement.scrollLeft + documentElement.clientWidth - this.offsetWidth); _top: expression_r(documentElement.scrollTop + documentElement.clientHeight - this.offsetHeight);
            filter:Alpha(Opacity=30);
            opacity: 0.3;
        }

        #process_div_pic{
            position:fixed;
            top:50%;
            left:50%;
            z-index:100000000;
            margin:-16px 0 0 -50px;
            width:100px;
            height:32px;
            color: #fff;
        }
        .download{position: fixed; right: 20px; top: 120px; height: 100px; overflow: hidden; z-index: 1000;}
        .download p{font-size: 12px;}
        .download_icon{font-size: 36px; position:relative;animation-name:myfirst;animation-duration:2s;animation-timing-function:linear;animation-iteration-count:infinite;animation-direction:alternate;animation-play-state:running;
            /* Firefox: */
            -moz-animation-name:myfirst; -moz-animation-duration:2s;-moz-animation-timing-function:linear;-moz-animation-iteration-count:infinite;-moz-animation-direction:alternate;-moz-animation-play-state:running;
            /* Safari and Chrome: */
            -webkit-animation-name:myfirst;-webkit-animation-duration:2s;-webkit-animation-timing-function:linear;-webkit-animation-iteration-count:infinite;-webkit-animation-direction:alternate;-webkit-animation-play-state:running;
            /* Opera: */
            -o-animation-name:myfirst;-o-animation-duration:2s;-o-animation-timing-function:linear;-o-animation-delay:2s;-o-animation-iteration-count:infinite;-o-animation-direction:alternate;-o-animation-play-state:running;}
        .add_citymember{wposition: absolute;}
        .show_cmBig{wposition: absolute;}
        .add_TestMember{wposition: absolute;}
        .toast{
            width:450px;
            height:240px;
            background:transparent;
            background-color:rgba(241,241,241,1);
            box-shadow: 0 1px 1px rgba(0,0,0,1);
            border-radius:10px;
            position: fixed;
            z-index: 1;
        }
        .toast li{float:left; line-height: 28px; color: #0096BB; margin-top: 5px;}
        .bigtoast{
            width:350px;
            height:240px;
            background:transparent;
            background-color:rgba(241,241,241,1);
            box-shadow: 0 1px 1px rgba(0,0,0,1);
            border-radius:10px;
            position: absolute;
            /*margin:auto;left:25%; top:60%;*/
            z-index: 1;
        }

        .trytoast{
            width:450px;
            height:240px;
            background:transparent;
            background-color:rgba(241,241,241,1);
            box-shadow: 0 1px 1px rgba(0,0,0,1);
            border-radius:10px;
            position: fixed;
            z-index: 1;
        }
        .trytoast li{float:left; line-height: 28px; color: #0096BB; margin-top: 5px;}
    </style>
	<script type="text/javascript" src="js/jquery-1.3.2.js"></script>
	<script type="text/javascript" src="js/custom.js"></script>
	<script type="text/javascript" src="js/superfish.js"></script>
	<script type="text/javascript" src="js/jquery-ui-1.7.2.js"></script>
	<script type="text/javascript" src="js/tooltip.js"></script>
	<script type="text/javascript" src="js/tablesorter.js"></script>
	<script type="text/javascript" src="js/tablesorter-pager.js"></script>
	<script type="text/javascript" src="js/cookie.js"></script>
	<script type="text/javascript" src="../scripts/bidLibjsjquery4.0.js"></script>
	<script type="text/javascript" src="../scripts/bidLib.js"></script>
	<script type="text/javascript" src="../scripts/auto.js"></script>
	<script type="text/javascript" src="../startbootstrap/js/echarts.min.js"></script>
</head>


<script>
    var win;
    var array=new Array();
	var curr_user;
	var platformid = null;
	var storeno_unique;
	function initcurruser(){
  		//取得当前登录人的门店
		doManager("UserManager", "getCurrentUserDTO",null,
    				function(data, textStatus, XMLHttpRequest) {
    					if (data.result) {
    						 curr_user = JSON.parse(data.data);
    						 initCurrStore(curr_user.store_id);
    					}
    	},false);
  	}
	
	
    $(function () {
    	
    	
    	//alert('jQuery版本：' + $.fn.jquery);
    	initCareerGroup();
    	
    	initcurruser();
    	doClean();
        //页面加载成功后需要获取数据
        searchList();
        
        $("#imp_base_div").click(function(){
            $("#imp_data_div").toggle(500);
            if($("#imp_base_div").html()=="-"){
            	$("#imp_base_div").html("+");
            }else{
            	$("#imp_base_div").html("-");
            }
        });
        
        $("#cstmz_actv").remove();
        
        $(".display").css("width","auto");
        

    });

    
     //初始化所有的事业群 
	function initCareerGroup(){
		doManager("DataHumanTypeManager", "queryAllDataHumanTypes", null,
				function(data, textStatus, XMLHttpRequest) {
					if (data.result) {
						var jsonData = $.fromJSON(data.data);
						for (i = 0; i < jsonData.length; i++) {
							$("#career_group").append("<option>" + jsonData[i].career_group + "</option>");
						}
					}
				}, false);
	}
     
     
     
	//初始化当前门店
	function initCurrStore(store_id){
		doManager("StoreManager", "findStore", [store_id],
				function(data, textStatus, XMLHttpRequest) {
					if (data.result) {
						var jsonData = $.fromJSON(data.data);
						//alert(jsonData.platformid);
						platformid = jsonData.platformid;
						storeno_unique = jsonData.storeno;
						$("#platformid").val(platformid);
					}
				}, false);
		
        
         loadTable(platformid); 
	}
  
    //记载页面时请求数据列表默认的方法
    function searchList() {
    	//判断是否多个门店 发生切换变化 
    	if(!checkStoreChange()){
    		return;
    	}
        $$.executeSearch('querystoreorderlist', 'conditionsDiv');
        $("#cstmz_actv").remove();
        $(".display").css("width","auto");
    }

    //验证是不是空
    function isnull(str) {
        return str == null || str == "null" || str == "" || str == "undefined" || typeof(str) == "undefined";
    }


    function doClean() {
        //document.service_qa.reset();
        $("#store\\.id").val("");
    }

  //列表中 列的处理
    var COLUMNS = {
            "worder_type": function(aData, iColumn, sColumnName, map){
                var value = map[sColumnName];
                var ret = "";
                if(value!=null&&value==0){
                	ret="产品类";
                }
                if(value!=null&&value==1){
                	ret="服务类";
                }
                return ret;
            },
            "worder_status": function(aData, iColumn, sColumnName, map){
            	var value = map[sColumnName];
                var ret = "";
                if(value!=null&&value==0){
                	ret="待确认";
                }
                if(value!=null&&value==1){
                	ret="客户确认中";
                }
                if(value!=null&&value==2){
                	ret="已确认";
                }
                if(value!=null&&value==3){
                	ret="已完成";
                }
                if(value!=null&&value==4){
                	ret="已取消";
                }
                return ret;
            }
        }
    
  
  
  
  function toEditCareerPage(id){
	  //点击编辑事业群时，判断门店是否变化
    	if(!checkStoreChange()){
    		return;
    	}
	  
	  //此处 先根据ID查询 是否分配过 事业群 然后取出来 
	  var src_career_group = "";
	  doManager("HumanresourcesManager", "queryHumanresourceById", [id],
				function(data, textStatus, XMLHttpRequest) {
					if (data.result) {
						var jsonData = $.fromJSON(data.data);
						src_career_group = jsonData.career_group;
					}
		}, false);
	  
		$("#career_group").attr("value",src_career_group);
		$("#career_group option[text='"+src_career_group+"']").attr("selected", true);
	  
    	var div = $("#doStoreMultDiv");
	      div.dialog({
	          bgiframe : true,
	          title : "修改事业群数据",
	          width : 380,
	          height : 300,
	          buttons : {
	              "确定" : function() {
	                  doUpdateHumanresourceCareerGroup($(this),id);
	              },
	              "取消" : function() {
	                  $(this).dialog("close");
	              }
	          },
	          modal : false
	      });
  }
  
    //判断默认门店 是否发生切换了。
    function checkStoreChange(){
    	var top_store=window.parent.document.getElementById("userName").innerHTML;
   		//var top_store=window.top.frames['i2ui_shell_top'].document.getElementById("userName").innerHTML;
    	   var storeischange=false;
    	 	//取得当前门店 状态 
   	       	doManager("storeManager", "queryCurrentStoreInfo",null,
   					function(data, textStatus, XMLHttpRequest) {
   						if (data.result) {
   							var curStoreObj = JSON.parse(data.data);
   							curStore = curStoreObj;
   						}
   			},false);
    	   if(top_store!=null&&top_store.length>0){
    		  var str_arr = top_store.split('<option');
    		  for(i=0;i<str_arr.length;i++){
    			  var va = str_arr[i];
    			  if(va.indexOf('selected=')>-1&&va.indexOf(curStore.name)<0){
    				  storeischange = true;
    			  }
    		  }
    	   }
    	   if(storeischange){
    		   $$.showConfirm("提示","门店发生异动！ 需要刷新页面！ ",function () {
    			   parent.location.reload();
   				});
    		   return;
    	   }
    	   return true;
   	}
  
  function doUpdateHumanresourceCareerGroup(obj_div,id){
	  var career_group = $("#career_group  option:selected").val();
	  //alert(id+"--"+career_group);
	  var obj = new Object();
	  obj.id=id;
	  obj.career_group=career_group;
	  
	  doManager("HumanresourcesManager", "updateHumanresourceCareerGroupById",obj,
		 function(data, textStatus, XMLHttpRequest) {
						if (data.result) {
							var curStoreObj = JSON.parse(data.data);
							if(curStoreObj!=null){
								searchList();
								obj_div.dialog("close");
							}
						}else{
							$$.showMessage("系统信息", "修改失败 !");
						}
	     },false);
	  
  }
  
  
  function addStoreOrder(){
	  window.location.href="storeorder_add.html";	
  }
    
  
  
  /* var editObj = {
			html : '<a href="#">编辑 </a>',
			resourceId : "storeorder_List_update",
			func : function(queryid, data, nTr, allColumns, allColumnsDataMap) {
				var id = allColumnsDataMap.id;
				window.location.href = "storeorder_edit.html?id="+id;
			}
		} */
  
  //$pmspage.opArr = [ editObj /*, publishObj  , deleteObj*/ ];
  
  
   function loadTable(platformid){
	  doManager("BusinessReportManager", "queryBusinesSummary",platformid,
				 function(data, textStatus, XMLHttpRequest) {
								if (data.result) {
									var curStoreObj = JSON.parse(data.data);
									if(curStoreObj!=null){
										searchList();
										obj_div.dialog("close");
									}
								}else{
									$$.showMessage("系统信息", "修改失败 !");
								}
			     },false);
  } 
</script>
<!-- --------------------------------------------------------Echarts 部分-------------------------------------------------------------- -->
<script>
Date.prototype.format = function() {  
    var s = '';  
    var mouth = (this.getMonth() + 1)>=10?(this.getMonth() + 1):('0'+(this.getMonth() + 1));  
    var day = this.getDate()>=10?this.getDate():('0'+this.getDate());  
    s += this.getFullYear() + '-'; // 获取年份。  
    s += mouth + "-"; // 获取月份。  
    s += day; // 获取日。  
    return (s); // 返回日期。  
};

</script>
<script>
 var storeNo = decode64(getUrlParamByKey("so"));//门店no
 var target = decode64(getUrlParamByKey("t"));//执行人级别 
 var storeName=decode64(getUrlParamByKey("sn"));//门店名称
 var cityname = decode64(getUrlParamByKey("cn"));//城市名称
 var screenlogin=getUrlParamByKey("su");
 var storeNo_ = (decode64(getUrlParamByKey("so")) == 'null'||decode64(getUrlParamByKey("so")) == null) ? '' : decode64(getUrlParamByKey("so"));//门店no
 var ordertype = (decode64(getUrlParamByKey("ordertype")) == 'null'||decode64(getUrlParamByKey("ordertype")) == null) ? '' : decode64(getUrlParamByKey("ordertype"));//商品服务团购 全部:0;商品1服务2团购3
 var storeName_ = (decode64(getUrlParamByKey("store_name")) == 'null'||decode64(getUrlParamByKey("store_name")) == null) ? '' : decode64(getUrlParamByKey("store_name"));//商品服务团购 全部:0;商品1服务2团购3
 //var ta = getUrlParamByKey("ta");
 
 function loginShow(){
		
		if(screenlogin!=null&&screenlogin!=''&&screenlogin!=undefined){
            var b = new Base64();
            screenlogin=b.decode(screenlogin);
            var obj=JSON.parse(screenlogin);
            var reObj = new PMSRequestObject("userManager", "isAppScreenUser", [obj.code,obj.employeeId,obj.password]);
		    var callback = function callback(data, textStatus, XMLHttpRequest) {
		    	//window.parent.location=getRootPath() + "/crm/index_K.html?pls=0";
		    	var stateObject = {};
		    	var newUrl = "/daqWeb/crm/index_K.html?ta=0";
		    	history.pushState(stateObject,null,newUrl);
			};
		    var failureCallback = function failureCallback(data, textStatus, XMLHttpRequest) {
				alert("登录信息错误，请确认输入或联系管理员!");
				return false;
			}
		    var url = "../login.do";
		    $$.ajax(url, "requestString=" + reObj.toJsonString(), callback, failureCallback); 
		}else{
			getUser();
		}
		
	}

//   var myChart1 = echarts.init(document.getElementById('main1'));
//  var myChart2 = echarts.init(document.getElementById('main2'));
//  var myChart3 = echarts.init(document.getElementById('main3'));

  //K线图
  function randomData(data_value) {
      now = new Date(+now + 5000);
      return {
          name: now.toString(),
          value: [
              now,
              data_value
              //Math.round(value)
          ]
      }
  }
 
  var data = [];
  var now = new Date();
  now.setMinutes (now.getMinutes () - 7);//设置起始时间为当前时间的前2分钟
  
  var option1 = {
      backgroundColor: '#f55a44',

      tooltip: {
          trigger: 'axis',
          formatter: function (params) {
              params = params[0];
              var date = new Date(params.name);
              return date.getHours() + ':' + date.getMinutes() + ':' + date.getSeconds() + ' 成交额 ' + params.value[1];
          },
          axisPointer: {
              animation: false
          }
      },
      legend: {
          y: '10%',
          data: ['GMV', ]
      },
      grid: {
          left: '2%',
          right: '2%',
          bottom: '5%',
          top: '15%',
          containLabel: true
      },
      xAxis: {
          type: 'time',
          splitLine: {
              show: false
          },
          axisLine: {
              lineStyle: {color: '#fff'}
          },
      },
      yAxis: [{
          name: 'GMV',
          type: 'value',
          boundaryGap: [0, '100%'],
          min: function(value){
        	   	 return parseInt(value.min);
          	   },
          axisLine: {
              lineStyle: {color: '#fff'}
          },
          splitLine: {
              show: false
          },
          axisLabel: {
              color: '#fff'
          },
          axisTick: {
              show: false
          },
      },
      ],
      series: [{
          name: '营业额',
          type: 'line',
          showSymbol: false,
          hoverAnimation: false,
          data: data,
          lineStyle: {
              normal: {
                  color: '#fff'
              }
          },
          markPoint : {
			  data : [
				  {type : 'max', name: '最大值'},
			  ],
			  itemStyle:{normal: {color:'#b18b25'}},
			  emphasis: {
			      itemStyle:{normal: {color:'#000'}}
			  }
		  },
      }]
  };

  var lastData = 11;
  var axisData;
  var timeTicket;
//     clearInterval(timeTicket);
//   timeTicket = setInterval(loadtime, 5000);
  function loadtime (){
//       lastData += Math.random() * ((Math.round(Math.random() * 10) % 2) == 0 ? 1 : -1);
//       lastData = lastData.toFixed(1) - 0;
//       axisData = (new Date()).toLocaleTimeString().replace(/^\D*/,'');
      
//       doManager("BusinessReportManager","queryDayTurnover",[shareChartStatDto],
//   			function(data,textStatus,XmlHttpRequest){
//   				if (data.result) {
//   					var jsonData = $.fromJSON(data.data);
//   					real_value = jsonData.day_amount;
//   				}
//   		});
      
//       data.push(randomData(real_value));
//       data.splice(0,1);
//       myChart1.setOption({
//           series: [{
//               data: data
//           }]
//       });
  }
  
  //营业额分布
//   var online = 0;
//   var offline = 0;
  var option2 = {
	backgroundColor:'#5e5e5e',
	title : {
	  text: '营业额分布（2018年）',
	  textStyle: {
		color: '#fff'
	  },
	  x:'center'
	},
	tooltip: {
	  trigger: 'item',
// 	  formatter: "{b}: {c} ({d}%)",
	  formatter:function(a){
		  return a.data.name+": "+changeMoney(parseInt(a.data.value))+" ("+a.percent+"%)";
	  },
	  position: 'bottom'
	},
	legend: {
	  bottom: 10,
	  left: 'center',
	  textStyle: {
		color: '#fff'
	  },
	  data:['线上营业额','到店营业额']
	},
	series: [
	  {
		type:'pie',
		radius: ['50%', '70%'],
		avoidLabelOverlap: false,
		label: {
		  normal: {
			show: false,
			position: 'center'
		  },
		  emphasis: {
			show: true,
			textStyle: {
			  fontSize: '20',
			  fontWeight: 'bold'
			}
		  }
		},
		labelLine: {
		  normal: {
			show: false
		  }
		},
		data:[
		  {
			value:0,
			name:'线上营业额',
			itemStyle: {
			  normal: {
				color:'#f55a44'
			  },
			},

		  },
		  {
			value:0,
			name:'到店营业额',
			itemStyle: {
			  normal: {
				color:'#fff'
			  },
			},

		  }
		]
	  }
	]
  };

  //门店GMV散点图
  var dataBJ = [];

  var schema = [
    {name: 'order', index: 0, text: '订单量'},
    {name: 'gmv', index: 1, text: 'GMV'},
    {name: 'city', index: 2, text: '城市'},
    {name: 'store', index: 3, text: '门店'},
    {name: 'month', index: 3, text: '月份'}
  ];


  var itemStyle = {
    normal: {
      opacity: 0.8,
      shadowBlur: 10,
      shadowOffsetX: 0,
      shadowOffsetY: 0,
      shadowColor: 'rgba(0, 0, 0, 0.5)'
    }
  };

  option3 = {
    backgroundColor: '#e1e1e1',
    title: {
      text: "GMV门店分布",
      left: "10",
      y: "10",
      textStyle: {
        color: "#666"
      }
    },
    color: [
      '#dd4444', '#fec42c', '#80F1BE'
    ],
    legend: {
      y: 'top',
      data: ['门店GMV', '上海', '广州'],
      textStyle: {
        color: '#666',
        fontSize: 16
      }
    },
    grid: {
      //x: '10%',
      //x2: 80,
      y: '28%',
      y2: '20%',
      bottom:'10%',
      left:'5%'
    },
    tooltip: {
      padding: 10,
      backgroundColor: '#222',
      borderColor: '#777',
      borderWidth: 1,
      formatter: function (obj) {
        var value = obj.value;
        return '<div style="border-bottom: 1px solid rgba(255,255,255,.3); font-size: 18px;padding-bottom: 7px;margin-bottom: 7px">'
          + schema[1].text + '：' + value[1] + '万元</div>'
          + schema[0].text + '：' + value[0] + '<br>'
          + schema[2].text + '：' + value[2] + '<br>'
          + schema[3].text + '：' + value[3] + '<br>'
          + schema[4].text + '：' + value[4] + '<br>';
      }
    },
    xAxis: {
      type: 'value',
      name: '订单量',
      nameGap: 16,
      nameTextStyle: {
        color: '#666',
        fontSize: 14
      },
      min: function(value){
  	   	 return parseInt(value.min);
  	   },
      splitLine: {
        show: false
      },
      axisLine: {
        lineStyle: {
          color: '#666'
        }
      }
    },
    yAxis: {
      type: 'value',
      name: '门店GMV（万元）',
      nameLocation: 'end',
      nameGap: 20,
      min: function(value){
 	   	 return parseInt(value.min);
   	   },
      nameTextStyle: {
        color: '#666',
        fontSize: 16
      },
      axisLine: {
        lineStyle: {
          color: '#666'
        }
      },
      splitLine: {
        show: false
      }
    },
    visualMap: [
      {
        left: 'right',
        top: '10%',
        dimension: 1,
        min: 0,
        max: 500,
        itemWidth: 30,
        itemHeight: 100,
        calculable: true,
        precision: 0.1,
        text: ['圆形大小：门店GMV'],
        textGap: 30,
        textStyle: {
          color: '#666'
        },
        inRange: {
          symbolSize: [10, 70]
        },
        outOfRange: {
          symbolSize: [10, 70],
          color: ['rgba(255,255,255,.2)']
        },
        controller: {
          inRange: {
            color: ['#c23531']
          },
          outOfRange: {
            color: ['#666']
          }
        }
      },
      {
        left: 'right',
        bottom: '5%',
        dimension: 0,
        min: 0,
        max: 5000,
        itemHeight: 100,
        calculable: true,
        precision: 0.1,
        text: ['明暗：订单量'],
        textGap: 30,
        textStyle: {
          color: '#666'
        },
        inRange: {
          colorLightness: [1, 0.5]
        },
        outOfRange: {
          color: ['rgba(255,255,255,.2)']
        },
        controller: {
          inRange: {
            color: ['#c23531']
          },
          outOfRange: {
            color: ['#666']
          }
        }
      }
    ],
    series: [
      {
        name: '门店GMV',
        type: 'scatter',
        itemStyle: itemStyle,
        data: dataBJ,
      },
    ]
  };

</script>
<script>
  var chart4;
  var chart4_option;
  function chartresize1(){
	var temp1 = new initchart1();
	temp1.resize();
  }
  var initchart1 = function(){
	chart4 = echarts.init(document.getElementById('main4'));

    //K线图--分时
    var xData = function() {
      var data = [];
      for (var i = 0; i < 24; i++) {
        data.push(i + "时");
      }
      return data;
    }();

    chart4_option = {
      backgroundColor: "#f55a44",
      tooltip: {
        trigger: 'axis',
        axisPointer: {
          textStyle: {
            color: '#fff'
          }

        },
      },
      grid: {
        borderWidth: '0',
        left: '5%',
        right: '5%',
        bottom: '30%',
        top: '10%',

      },
      calculable: true,
      xAxis: [{
        type: 'category',
        boundaryGap: false,
        axisLine: {
          lineStyle: {
            color: '#333'
          }
        },
        splitLine: {
          show: false
        },
        axisTick: {
          show: true
        },
        splitArea: {
          show: false
        },
        axisLabel: {
          interval: 0,

        },
        data: xData,
      }],
      yAxis: [{
        type: 'value',
        splitLine: {
          show: false
        },
        axisLine: {
          lineStyle: {
            color: '#333'
          }
        },
        axisTick: {
          show: false
        },
        axisLabel: {
          interval: 1,

        },
        splitArea: {
          show: false
        },

      }],
      dataZoom: [{
        show: true,
        height: '30',
        xAxisIndex: [0],
        bottom: '30',
        start: '0',
        end: '100',
        handleIcon: 'path://M306.1,413c0,2.2-1.8,4-4,4h-59.8c-2.2,0-4-1.8-4-4V200.8c0-2.2,1.8-4,4-4h59.8c2.2,0,4,1.8,4,4V413z',
        handleSize: '110%',
        handleStyle:{
          color:"#d3dee5",
        },
        textStyle:{color:'#fff'},
        borderColor:"#90979c",
        //backgroundColor:'#fff'
      }],
      series: [{
        name: "总数",
        type: "line",
        stack: "总量",
		smooth: true,
		showAllSymbol: true,
		symbol: 'emptyCircle',
		symbolSize: 15,
        itemStyle: {
          normal: {
            color: '#fff',
            barBorderRadius: 0,
            label: {
              show: true,
              position: 'top',
              formatter: function(p) {
                return p.value > 0 ? (p.value) : '';
              }
            }
          }
        },
        data:hourData
      },
      ]
    }


   chart4.setOption(chart4_option);
	$(function(){
	  window.onresize = function(){
		chart4.resize();
		/*chart5.resize();
		chart6.resize();*/
	  }
	})
	this.resize = function size(){
	  var chart4div=document.getElementById('main4');
	  var tabcontent = document.getElementById('tab-content');
	  width=tabcontent.offsetWidth;
	  chart4div.style.width=width+'px';
	  chart4.resize(width);
	}
  }
</script>
<script>
   var xData = [];
   var yData = [];
   var chart5;
   var chart5_option;
  function chartresize2(){
    //console.log("chartresize");
    var temp2 = new initchart2();
    temp2.resize();
  }
  var initchart2 = function(){
  	chart5 = echarts.init(document.getElementById('main5'));

    //K线图--日
    var xData = function() {
      var data = [];
      var fistDay = getFirstDayOfYear();
      var curDay = now.getFullYear() + "-" + (now.getMonth() + 1) + "-" + now.getDate();
      data = getAllDate(fistDay,curDay);
      return data;
    }();
  	
    chart5_option = {
      backgroundColor: "#f55a44",
      tooltip: {
        trigger: 'axis',
        axisPointer: {
          textStyle: {
            color: '#fff'
          }

        },
      },
      grid: {
        borderWidth: '0',
        left: '5%',
        right: '5%',
        bottom: '30%',
        top: '10%',

      },
      calculable: true,
      xAxis: [{
        type: 'category',
        boundaryGap: false,
        axisLine: {
          lineStyle: {
            color: '#333'
          }
        },
        splitLine: {
          show: false
        },
        axisTick: {
          show: true
        },
        splitArea: {
          show: false
        },
//         axisLabel: {
//           interval: 0,
//         },
        data: xData,
      }],
      yAxis: [{
        type: 'value',
        splitLine: {
          show: false
        },
        axisLine: {
          lineStyle: {
            color: '#333'
          }
        },
        axisTick: {
          show: false
        },
        axisLabel: {
          interval: 0,

        },
        splitArea: {
          show: false
        },

      }],
      dataZoom: [{
        show: true,
        height: '30',
        xAxisIndex: [0],
        bottom: '30',
        start: '50',
        end: '100',
        handleIcon: 'path://M306.1,413c0,2.2-1.8,4-4,4h-59.8c-2.2,0-4-1.8-4-4V200.8c0-2.2,1.8-4,4-4h59.8c2.2,0,4,1.8,4,4V413z',
        handleSize: '110%',
        handleStyle:{
          color:"#d3dee5",
        },
        textStyle:{color:'#fff'},
        borderColor:"#90979c",
        //backgroundColor:'#fff'
      }],
      series: [{
        name: "总数",
        type: "line",
        stack: "总量",
        symbolSize:10,
        symbol:'circle',
        itemStyle: {
          normal: {
            color: '#fff',
            barBorderRadius: 0,
            label: {
              show: true,
              position: 'top',
              formatter: function(p) {
                return p.value > 0 ? (p.value) : '';
              }
            }
          }
        },
        data:yData
      },
      ]
    }

    chart5.setOption(chart5_option);
    $(function(){
      window.onresize = function(){
        chart5.resize();
      }
    })
    this.resize = function size(){
      var chart5div=document.getElementById('main5');
      var tabcontent = document.getElementById('tab-content');
      width=tabcontent.offsetWidth;
      //height=tabcontent.offsetHeight;
      chart5div.style.width=width+'px';
      chart5.resize(width);
    }
    
  	chart5.on('click', function (params) {
	  	var dayTime = "";
	  	dayTime = params.name;
	  	var dataParam = getShareParam();
	  	var storename = $("#store_name_manual").val()==null?"":$("#store_name_manual").val();
	  	var deptname = dataParam.deptname==null?"":dataParam.deptname;
	  	var cityname = dataParam.cityname==null?"":dataParam.cityname;
	  	var storeno = dataParam.storeno==null?"":dataParam.storeno;
	  	var channelname = dataParam.channelname==null?"":dataParam.channelname;
	  	var redirectTag = "day";
	    if(target==0){
			url = "searchData_view.html?t="+encode64('0')+"&s=&c=&e=&r=&dn="+encode64(deptname)+"&channel="+encode64(channelname)+"&cn="+encode64(cityname)+"&so="+encode64(storeno)+"&sn="+encode64(storename)+"&time="+encode64(dayTime)+"&rt="+encode64(redirectTag);
		}else if(target==1){
			url = "searchData_view.html?t="+encode64(1)+"&e=&dn="+encode64(deptname)+"&channel="+encode64(channelname)+"&cn="+encode64(cityname)+"&so="+encode64(storeno)+"&sn="+encode64(storename)+"&time="+encode64(dayTime)+"&rt="+encode64(redirectTag);
		}
		window.open(url,"searchData_view");
	});
  }
</script>
<script>
	var chart7 ;
	var chart7_option;
	var xData_week=[];
	function chartresize4(){
		//console.log("chartresize");
		var temp4 = new initchart4();
		temp4.resize();
	}
	var initchart4 = function(){
		chart7 = echarts.init(document.getElementById('main7'));

// 		//K线图--周

		chart7_option = {
			backgroundColor: "#f55a44",
			tooltip: {
				trigger: 'axis',
				axisPointer: {
					textStyle: {
						color: '#fff'
					}

				},
			},
			grid: {
				borderWidth: '0',
				left: '5%',
				right: '5%',
				bottom: '30%',
				top: '10%',

			},
			calculable: true,
			xAxis: [{
				type: 'category',
				boundaryGap: false,
				axisLine: {
					lineStyle: {
						color: '#333'
					}
				},
				splitLine: {
					show: false
				},
				axisTick: {
					show: true
				},
				splitArea: {
					show: false
				},
				/* axisLabel: {
					interval: 0,

				}, */
				data: xData_week,
			}],
			yAxis: [{
				type: 'value',
				splitLine: {
					show: false
				},
				axisLine: {
					lineStyle: {
						color: '#333'
					}
				},
				axisTick: {
					show: false
				},
				axisLabel: {
					interval: 0,

				},
				splitArea: {
					show: false
				},
				
			}],
			dataZoom: [{
			 show: true,
			 height: '30',
			 xAxisIndex: [0],
			 bottom: '30',
			 start: '10',
			 end: '100',
			 handleIcon: 'path://M306.1,413c0,2.2-1.8,4-4,4h-59.8c-2.2,0-4-1.8-4-4V200.8c0-2.2,1.8-4,4-4h59.8c2.2,0,4,1.8,4,4V413z',
			 handleSize: '110%',
			 handleStyle:{
			 color:"#d3dee5",
			 },
			 textStyle:{color:'#fff'},
			 borderColor:"#90979c",
			 //backgroundColor:'#fff'
			 }],
			series: [{
				name: "总数",
				type: "line",
				stack: "总量",
				symbolSize:10,
				symbol:'circle',
				itemStyle: {
					normal: {
						color: '#fff',
						barBorderRadius: 0,
						label: {
							show: true,
							position: 'top',
							formatter: function(p) {
								return p.value > 0 ? (p.value) : '';
							}
						}
					}
				},
				data: weekData
			},
			]
		}

		chart7.setOption(chart7_option);
		$(function(){
			window.onresize = function(){
				chart7.resize();
			}
		})
		this.resize = function size(){
			var chart7div=document.getElementById('main7');
			var tabcontent = document.getElementById('tab-content');
			width=tabcontent.offsetWidth;
			//height=tabcontent.offsetHeight;
			chart7div.style.width=width+'px';
			chart7.resize(width);
		}
	}
</script>
<script>
	var yData_month = [];
	var yData_month_target = [];
	var chart6;
	var chart6_option;
	function chartresize3(){
		//console.log("chartresize");
		var temp3 = new initchart3();
		temp3.resize();
	}
	var initchart3 = function(){
		chart6 = echarts.init(document.getElementById('main6'));

		//K线图--月
		var xData_month = function() {
			var data = [];
			var curMonth = now.getFullYear()+'-12-31';
			data = getYearAndMonth('2017-12-1',curMonth);
			return data;
		}();

		chart6_option = {
			backgroundColor: "#f55a44",
			tooltip: {
				trigger: 'axis',
				axisPointer: {
					textStyle: {
						color: '#fff'
					}

				},
			},
			grid: {
				borderWidth: '0',
				left: '6%',
				right: '5%',
				bottom: '30%',
				top: '10%',

			},
			legend: {
				x: '78%',
				top: '1%',
				data: ['月总数', '经营指标']
			},


			calculable: true,
			xAxis: [{
				type: 'category',
				boundaryGap: false,
				axisLine: {
					lineStyle: {
						color: '#333'
					}
				},
				splitLine: {
					show: false
				},
				axisTick: {
					show: true
				},
				splitArea: {
					show: false
				},
				axisLabel: {
					interval: 0,

				},
				data: xData_month,
			}],
			yAxis: [{
				type: 'value',
				splitLine: {
					show: false
				},
				axisLine: {
					lineStyle: {
						color: '#333'
					}
				},
				axisTick: {
					show: false
				},
				axisLabel: {
					interval: 0,

				},
				splitArea: {
					show: false
				},

			}],
			dataZoom: [{
				show: true,
				height: '30',
				xAxisIndex: [0],
				bottom: '30',
				start: '0',
				end: '45',
				handleIcon: 'path://M306.1,413c0,2.2-1.8,4-4,4h-59.8c-2.2,0-4-1.8-4-4V200.8c0-2.2,1.8-4,4-4h59.8c2.2,0,4,1.8,4,4V413z',
				handleSize: '110%',
				handleStyle:{
					color:"#d3dee5",
				},
				textStyle:{color:'#fff'},
				borderColor:"#90979c",
				//backgroundColor:'#fff'
			}],
			series: [{
				name: "月总数",
				type: "line",
				symbolSize:10,
				symbol:'circle',
				itemStyle: {
					normal: {
						color: '#fff',
						barBorderRadius: 0,
						label: {
							show: true,
							position: 'top',
							formatter: function(p) {
								return p.value > 0 ? (p.value) : '';
							}
						}
					}
				},
				data:yData_month
			},
			{
				name: "经营指标",
				type: "line",
				symbolSize:10,
				symbol:'circle',
				itemStyle: {
					normal: {
	                  color: '#000',
	                  barBorderRadius: 0,
	                  lineStyle:{
	                    width:2,
	                    type:'dotted'  //'dotted'虚线 'solid'实线
	                  }
	                }
				},
				data:yData_month_target
			},
			]
		}


		chart6.setOption(chart6_option);
		$(function(){
			window.onresize = function(){
				chart6.resize();
			}
		})
		this.resize = function size(){
			var chart6div=document.getElementById('main6');
			var tabcontent = document.getElementById('tab-content');
			width=tabcontent.offsetWidth;
			//height=tabcontent.offsetHeight;
			chart6div.style.width=width+'px';
			chart6.resize(width);
		}
	}
	
	var xData_week_temp = function() {
		var dataTemp = [];
		doManager("BusinessReportManager","getDateByWeek",null,
	   			function(data,textStatus,XmlHttpRequest){
	   				if (data.result) {
	   					var jsonData = $.fromJSON(data.data);
	   					dataTemp = jsonData;
	   				}
	   		},false);	
		return dataTemp;
	};
  
  var shareChartStatDto=null; //全局参数变量	
  var shareChartStatDto1=null;
  var shareChartStatDto2=null;
  var shareChartStatDto3=null;
  $(function(){
	  loginShow();
	  initalldept();
	  initallchannel();
	  initallchannelcontrast();
	  if(target==0){//总部
	  	initallcity(); 
	  	initallstore();
	  	initallstorecontrast();
	  }else if(target==1){//城市
	  	initcurcity();
	  	$("#citySelect option[value='"+cityname+"']").attr('selected',true);
	  	$("#citySelectContrast option[value='"+cityname+"']").attr('selected',true);
	  	initStoreSelectcomplate();
	  	initStoreSelectcomplateContrast();
	  }else if(target==2) {//门店
	  	initcurcity();
	  	$("#citySelect").prop("disabled", true);
		$("#citySelect option[value='"+cityname+"']").attr('selected',true);
		$("#citySelectContrast").prop("disabled", true);
		$("#citySelectContrast option[value='"+cityname+"']").attr('selected',true);
	  	initStoreSelectcomplate();
	  	initStoreSelectcomplateContrast();
	  	$("#store_id_manual").val(storeNo);
	  	$("#store_name_manual").val(storeName);
		$("#store_name_manual").attr("readonly",true);		
		$("#store_id_manual_contrast").val(storeNo);
	  	$("#store_name_manual_contrast").val(storeName);
		$("#store_name_manual_contrast").attr("readonly",true);
	  }else{
		  initallcity(); 
		  initallstore();
		  initallstorecontrast();
	  }
	  
	    var autoComplete = new AutoComplete("store_name_manual","auto",array);
	  	/* document.getElementById("store_name_manual").onkeyup = function(event){
	  		autoComplete.start(event);
	  		if($("#store_name_manual").val().trim() == ""){
				$("#store_id_manual").val("");
			}
	  		for(var key in storeJson){
	  			if(document.getElementById("store_name_manual").value==key){
	  				document.getElementById("store_id_manual").value=storeJson[key];
	  			}
	  		}
	  	} */
	  	/* $("#auto").on("click",function(event){
			for(var key in storeJson){
				if(document.getElementById("store_name_manual").value==key){
					document.getElementById("store_id_manual").value=storeJson[key];
				}
			}
		}); */
	  	
	  	//悬浮框事业群频道城市门店联动
	  	var autoCompleteContrast = new AutoComplete("store_name_manual_contrast","auto_contrast",array_contrast);
	  	/* document.getElementById("store_name_manual_contrast").onkeyup = function(event){
	  		autoCompleteContrast.start(event);
	  		if($("#store_name_manual_contrast").val().trim() == ""){
				$("#store_id_manual_contrast").val("");
			}
	  		for(var key in storeJsonContrast){
	  			if(document.getElementById("store_name_manual_contrast").value==key){
	  				document.getElementById("store_id_manual_contrast").value=storeJson[key];
	  			}
	  		}
	  	} */
	  	/* $("#auto_contrast").on("click",function(event){
			for(var key in storeJsonContrast){
				if(document.getElementById("store_name_manual_contrast").value==key){
					document.getElementById("store_id_manual_contrast").value=storeJson[key];
				}
			}
		}); */
	  	
	  	
	  xData_week = xData_week_temp();
	  initRealData();
	  chartresize1();
	  chartresize2();
	  chartresize3();
	  chartresize4();
	  search_manual_k();
	  
	  
	  timeTicket=setInterval(loadtime, 5000);
	  
	  /* $("#search-btn1").click(function(){
		 excuteChart();
	 });
	  $("#search-btn2").click(function(){
		 excuteChart();
	 }); 
	 $("#deptSelect").change(function(){
		 $('#cbLabel').children("div").addClass('checked'); 
		 iCheckStr = $('#cbClick').val();
		 excuteChart();
	 });
	 $("#channelSelect").change(function(){
		 $('#cbLabel').children("div").addClass('checked'); 
		 iCheckStr = $('#cbClick').val();
		 excuteChart();
	 });
	 $("#citySelect").change(function(){
		 $('#cbLabel').children("div").addClass('checked'); 
		 iCheckStr = $('#cbClick').val();
		 excuteChart();
	 }); */
	 //小B端iCheck
	 /* $('#cbClick').on('ifChecked', function(event){ //ifChecked 事件应该在插件初始化之前绑定 
		 iCheckStr = $(this).val();
		 excuteChart();
	 });
	 $('#cbClick').on('ifUnchecked', function(event){
		 iCheckStr = "";
		 excuteChart();
	 });
	 $('#cbClick').iCheck({
	  	checkboxClass: 'icheckbox_minimal-red'
	 });
	 //大B端iCheck
	 $('#maxbClick').on('ifChecked', function(event){ //ifChecked 事件应该在插件初始化之前绑定 
		 iCheckMaxStr = $(this).val();
		 excuteChart();
	 });
	 $('#maxbClick').on('ifUnchecked', function(event){
		 iCheckMaxStr = "";
		 excuteChart();
	 });
	 $('#maxbClick').iCheck({
	  	checkboxClass: 'icheckbox_minimal-red'
	 }); */
	  //＋对比
	  $("#search-btn-add").click(function(){
		  var labelName1 = $("#label_manual_first").html();
		  var labelName2 = $("#label_manual_second").html();
		  var labelName3 = $("#label_manual_third").html();
		  var labelName4 = $("#label_manual_fourth").html();
		  var labelName5 = $("#label_manual_fifth").html();
		  var lable_first = document.getElementById("warning_text");
	      lable_first.style.display = "block";
	    
		  var shareChartStatDtoTemp = getShareParam();
		  var storename = $("#store_name_manual").val()==null?'':$("#store_name_manual").val();
	      var deptName = shareChartStatDtoTemp.deptname==null?'全部事业群':shareChartStatDtoTemp.deptname;
	      var channelName = shareChartStatDtoTemp.channelname==null?'全部频道':shareChartStatDtoTemp.channelname;
	      var cityName = shareChartStatDtoTemp.cityname==null?'全部城市':shareChartStatDtoTemp.cityname;
	      var storeNo = shareChartStatDtoTemp.storeno==null?'':shareChartStatDtoTemp.storeno;
	      var nameStrTemp = deptName+" "+channelName+" "+cityName+" "+storename;
	      if($.trim(nameStrTemp)==$.trim(nameStr1Html) || $.trim(nameStrTemp)==$.trim(nameStr2Html) || $.trim(nameStrTemp)==$.trim(nameStr3Html) 
	    		  || $.trim(nameStrTemp)==$.trim(nameStr4Html) || $.trim(nameStrTemp)==$.trim(nameStr5Html)){//对比条件重复过滤
	    	document.body.className = "skin-blue sidebar-mini"; 
    	  	return;
    	  }
	      if(labelName1.length==0){
		    	var lable_flag = document.getElementById("label_first_group");
		    	lable_flag.style.display = "block";
		    	var lable_reset = document.getElementById("label_first_reset");
				lable_reset.style.display = "block";
		    	shareChartStatDto1 = shareChartStatDtoTemp;
		    	nameStr1Html = nameStrTemp;
		    	$("#label_manual_first").html(nameStr1Html);
		    	nameStr1 = nameStr1Html+" "+storeNo;
		    }else if(labelName2.length==0){
		    	var lable_flag = document.getElementById("label_second_group");
		    	lable_flag.style.display = "block";
		    	var lable_reset = document.getElementById("label_second_reset");
				lable_reset.style.display = "block";
		    	shareChartStatDto2 = shareChartStatDtoTemp;
				nameStr2Html = nameStrTemp;
		    	$("#label_manual_second").html(nameStr2Html);
		    	nameStr2 = nameStr2Html+" "+storeNo;
		    }else if(labelName3.length==0){
		    	var lable_flag = document.getElementById("label_third_group");
		    	lable_flag.style.display = "block";
		    	var lable_reset = document.getElementById("label_third_reset");
				lable_reset.style.display = "block";
		    	shareChartStatDto3 = shareChartStatDtoTemp;
				nameStr3Html = nameStrTemp;
		    	$("#label_manual_third").html(nameStr3Html);
		    	nameStr3 = nameStr3Html+" "+storeNo;
		    }else if(labelName4.length==0){
		    	var lable_flag = document.getElementById("label_fourth_group");
		    	lable_flag.style.display = "block";
		    	var lable_reset = document.getElementById("label_fourth_reset");
				lable_reset.style.display = "block";
		    	shareChartStatDto4 = shareChartStatDtoTemp;
				nameStr4Html = nameStrTemp;
		    	$("#label_manual_fourth").html(nameStr4Html);
		    	nameStr4 = nameStr4Html+" "+storeNo;
		    }else if(labelName5.length==0){
		    	var lable_flag = document.getElementById("label_fifth_group");
		    	lable_flag.style.display = "block";
		    	var lable_reset = document.getElementById("label_fifth_reset");
				lable_reset.style.display = "block";
		    	shareChartStatDto5 = shareChartStatDtoTemp;
				nameStr5Html = nameStrTemp;
		    	$("#label_manual_fifth").html(nameStr5Html);
		    	nameStr5 = nameStr5Html+" "+storeNo;
		    }       
	      document.body.className = "skin-blue sidebar-mini"; 
	  });
	  
	  var nameStr1="";
	  var nameStr2="";
	  var nameStr3="";
	  var nameStr4="";
	  var nameStr5="";
	  var nameStr1Html="";
	  var nameStr2Html="";
	  var nameStr3Html="";
	  var nameStr4Html="";
	  var nameStr5Html="";
	  

	  $("#label_first_reset").click(function(){
		  nameStr1 = "";
		  nameStr1Html = "";
		  $("#label_manual_first").html("");
		  $("#channelSelectContrast").empty();
		  initallchannelcontrast();
		  var labelName1 = $("#label_manual_first").html();
		  var labelName2 = $("#label_manual_second").html();
		  var labelName3 = $("#label_manual_third").html();
		  var labelName4 = $("#label_manual_fourth").html();
		  var labelName5 = $("#label_manual_fifth").html();
		  var lable_reset = document.getElementById("label_first_group");
		  lable_reset.style.display = "none";
		  if(labelName1.length==0 && labelName2.length==0 && labelName3.length==0 
				  && labelName4.length==0 && labelName5.length==0){
			var lable_first = document.getElementById("warning_text");
  			lable_first.style.display = "none";
		  }
	  });
	  $("#label_second_reset").click(function(){
		  nameStr2 = "";
		  nameStr2Html = "";
		  $("#label_manual_second").html("");
		  $("#channelSelectContrast").empty();
		  initallchannelcontrast();
		  var labelName1 = $("#label_manual_first").html();
		  var labelName2 = $("#label_manual_second").html();
		  var labelName3 = $("#label_manual_third").html();
		  var labelName4 = $("#label_manual_fourth").html();
		  var labelName5 = $("#label_manual_fifth").html();
		  var lable_reset = document.getElementById("label_second_group");
		  lable_reset.style.display = "none";
		  if(labelName1.length==0 && labelName2.length==0 &&labelName3.length==0 
				  && labelName4.length==0 && labelName5.length==0){
			var lable_first = document.getElementById("warning_text");
  			lable_first.style.display = "none";
		  }
	  });
	  $("#label_third_reset").click(function(){
		  nameStr3 = "";
		  nameStr3Html = "";
		  $("#label_manual_third").html("");
		  $("#channelSelectContrast").empty();
		  initallchannelcontrast();
		  var labelName1 = $("#label_manual_first").html();
		  var labelName2 = $("#label_manual_second").html();
		  var labelName3 = $("#label_manual_third").html();
		  var labelName4 = $("#label_manual_fourth").html();
		  var labelName5 = $("#label_manual_fifth").html();
		  var lable_reset = document.getElementById("label_third_group");
		  lable_reset.style.display = "none";
		  if(labelName1.length==0 && labelName2.length==0 &&labelName3.length==0 
				  && labelName4.length==0 && labelName5.length==0){
			var lable_first = document.getElementById("warning_text");
  			lable_first.style.display = "none";
		  }
	  });
	  $("#label_fourth_reset").click(function(){
		  nameStr4 = "";
		  nameStr4Html = "";
		  $("#label_manual_fourth").html("");
		  $("#channelSelectContrast").empty();
		  initallchannelcontrast();
		  var labelName1 = $("#label_manual_first").html();
		  var labelName2 = $("#label_manual_second").html();
		  var labelName3 = $("#label_manual_third").html();
		  var labelName4 = $("#label_manual_fourth").html();
		  var labelName5 = $("#label_manual_fifth").html();
		  var lable_reset = document.getElementById("label_fourth_group");
		  lable_reset.style.display = "none";
		  if(labelName1.length==0 && labelName2.length==0 &&labelName3.length==0 
				  && labelName4.length==0 && labelName5.length==0){
			var lable_first = document.getElementById("warning_text");
  			lable_first.style.display = "none";
		  }
	  });
	  $("#label_fifth_reset").click(function(){
		  nameStr5 = "";
		  nameStr5Html = "";
		  $("#label_manual_fifth").html("");
		  $("#channelSelectContrast").empty();
		  initallchannelcontrast();
		  var labelName1 = $("#label_manual_first").html();
		  var labelName2 = $("#label_manual_second").html();
		  var labelName3 = $("#label_manual_third").html();
		  var labelName4 = $("#label_manual_fourth").html();
		  var labelName5 = $("#label_manual_fifth").html();
		  var lable_reset = document.getElementById("label_fifth_group");
		  lable_reset.style.display = "none";
		  if(labelName1.length==0 && labelName2.length==0 &&labelName3.length==0 
				  && labelName4.length==0 && labelName5.length==0){
			var lable_first = document.getElementById("warning_text");
  			lable_first.style.display = "none";
		  }
	  });
	  $("#contrast").click(function(){
		  var url = "";
		  if(target==0){
		  	url = "index_K_contrast.html?t="+encode64('0')+"&nameStr1="+encode64(nameStr1)+"&nameStr2="+encode64(nameStr2)+"&nameStr3="+encode64(nameStr3)+"&nameStr4="+encode64(nameStr4)+"&nameStr5="+encode64(nameStr5)+"&#ff";
		  }else if(target==1){
		  	url = "index_K_contrast.html?t="+encode64(1)+"&s=&sn=&c=cn="+encode64(pageStatusInfo.cityName)+"&e=&r=&nameStr1="+encode64(nameStr1)+"&nameStr2="+encode64(nameStr2)+"&nameStr3="+encode64(nameStr3)+"&nameStr4="+encode64(nameStr4)+"&nameStr5="+encode64(nameStr5)+"&#ff";
		  }else{
			  url = "index_K_contrast.html?t="+encode64('0')+"&nameStr1="+encode64(nameStr1)+"&nameStr2="+encode64(nameStr2)+"&nameStr3="+encode64(nameStr3)+"&nameStr4="+encode64(nameStr4)+"&nameStr5="+encode64(nameStr5)+"&#ff";
		  }
		  window.open(url,"index_K_contrast"); 
	  });
	  
  })
  
  function getUser(){
	doManager("UserManager", "getCurrentUserDTO",null,function(data, textStatus, XMLHttpRequest) {
		if (data.result) {
			var employeeID="";
			var curr_user = JSON.parse(data.data);
			if(curr_user == null){
				urlStr = "../logout.do";
				window.location.href = urlStr;
			}
		}
  	},false);
}
  
  //初始化实时图数据
//   var real_value;
  function initRealData(){
	  
  }
  
  var curDayGMV = '0';
  function inintCurDayData(){
	  doManager("BusinessReportManager","queryDayTurnover",[shareChartStatDto],
			function(datax,textStatus,XmlHttpRequest){
				if (datax.result) {
					var jsonData = $.fromJSON(datax.data);
					if(Object.keys(jsonData).length!=0){
						curDayGMV = jsonData.day_amount;
// 						real_value = jsonData.day_amount;
						$("#curDayGMV").html(parseFloat(curDayGMV).toLocaleString());
					}else{
						$("#curDayGMV").html('0');
					}
				}
		},false);
// 	  myChart1.setOption({
//           series: [{
//               data: data
//           }]
//       });
  }
  
  var curMonthData = '0';
  function initCurMonthData(){
		doManager("BusinessReportManager","queryMonthTurnover",[shareChartStatDto],
			function(data,textStatus,XmlHttpRequest){
				if (data.result) {
					var jsonData = $.fromJSON(data.data);
					if(Object.keys(jsonData).length!=0){
						curMonthData = jsonData.month_amount;
						$("#curMonthGMV").html(changeMoney(parseInt(curMonthData)));
					}else{
						$("#curMonthGMV").html('0万');
					}
				}
		});
	} 
  
  var hourData = [];  //0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
  function initHourData(){
 		doManager("BusinessReportManager","queryTurnoverByHour",[shareChartStatDto],
 			function(data,textStatus,XmlHttpRequest){
 				if (data.result) {
 					var nowHour = now.getHours();
 					hourData=new Array(nowHour+2).join(0).split('');
 					var jsonData = $.fromJSON(data.data);
 					if(jsonData.length!=0){
 						$(jsonData).each(function(index,element){
 	 						hourData[parseInt(element.time)]=element.turnover;
 	                     });
 						chart4_option.series[0].data=hourData;
 						chart4.setOption(chart4_option);
 					}else{
 						hourData = [];
 						chart4_option.series[0].data=hourData;
 						chart4.setOption(chart4_option);
 					}
 				}
 		});
 	} 
  
  function initDayData(){
	  var fistDay = getFirstDayOfYear();
	  var curDay = now.getFullYear() + "-" + (now.getMonth() + 1) + "-" + now.getDate();
	  xData = getAllDate(fistDay,curDay);
	  doManager("BusinessReportManager","queryTurnoverByDay",[shareChartStatDto],
			function(data,textStatus,XmlHttpRequest){
				if (data.result) {
					yData=new Array(xData.length+1).join(0).split('');
					var jsonData = $.fromJSON(data.data);
					if(jsonData.length!=0){
						$(jsonData).each(function(index,element){
							var indexTemp = jQuery.inArray(element.day_time,xData);
							yData[indexTemp]=element.turnover;
		                });
						chart5_option.series[0].data=yData;
						chart5.setOption(chart5_option);
					}else{
						yData = [];
						chart5_option.series[0].data=yData;
						chart5.setOption(chart5_option);
					}
				}
		});
  }
  
  var weekData = [];  //0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
  function initWeekData(){
	  weekData = new Array(xData_week.length+1).join(0).split('');
		doManager("BusinessReportManager","queryTurnoverByWeek",[shareChartStatDto],
			function(data,textStatus,XmlHttpRequest){
				if (data.result) {
					var jsonData = $.fromJSON(data.data);
					if(jsonData.length!=0){
						$(jsonData).each(function(index,element){
							var dateTemp = new Date(parseInt(element.week_time)).format("yyyy-MM-dd");
							var indexTemp = jQuery.inArray(dateTemp,xData_week);
							weekData[indexTemp]=element.week_amount;
	                    });
						chart7_option.series[0].data=weekData;
						chart7.setOption(chart7_option);
					}else{
						weekData = [];
						chart7_option.series[0].data=weekData;
						chart7.setOption(chart7_option);
					}
				}
		});
	} 
  
  Date.prototype.toLocaleString = function() {
      return this.getFullYear() + "-" + (this.getMonth() + 1) + "-" + this.getDate();
  }; 
  
  function initMonthData(){
	    var curMonth = now.getFullYear()+'-'+(now.getMonth()+1);
	    var months = getYearAndMonth('2017-12-1',curMonth);
		yData_month = new Array(months.length+1).join(0).split('');
		doManager("BusinessReportManager","queryTurnoverByMonth",[shareChartStatDto],
			function(data,textStatus,XmlHttpRequest){
				if (data.result) {
					var jsonData = $.fromJSON(data.data);
					if(jsonData.length!=0){
						$(jsonData).each(function(index,element){
							var indexTemp = jQuery.inArray(element.month_time,months);
							yData_month[indexTemp]=element.month_amount;
	               		});
						chart6_option.series[0].data=yData_month;
					}else{
						yData_month = [];
						chart6_option.series[0].data=yData_month;
					}
				}
		},false);
		
		doManager("BusinessReportManager","queryTargetByMonth",[shareChartStatDto],
			function(data,textStatus,XmlHttpRequest){
				if (data.result) {
					var jsonData = $.fromJSON(data.data);
					if(jsonData.length!=0){
						yData_month_target = new Array(12).join(0).split('');
						var curMonth = now.getFullYear()+'-12-31';
						var monthData = getYearAndMonth('2017-12-1',curMonth);
						$(jsonData).each(function(index,element){
							var indexTemp = jQuery.inArray(element.month_time,monthData);
							yData_month_target[indexTemp]=element.month_amount;
	               		});
						chart6_option.series[1].data=yData_month_target;
						chart6.setOption(chart6_option);
					}else{//没有数据时不显示
						yData_month_target = [];
						chart6_option.series[1].data=yData_month_target;
						chart6.setOption(chart6_option);
					}
				}
		});
		$("#process_div").hide();
		$("#process_div_pic").hide();
	} 
  
  function initOnlineOfflineTurnover(){
		doManager("BusinessReportManager","queryOnlineOfflineTurnover",[shareChartStatDto],
			function(data,textStatus,XmlHttpRequest){
				if (data.result) {
					var jsonData = $.fromJSON(data.data);
					option2.series[0].data[1].value = jsonData.offline_amount;
					option2.series[0].data[0].value = jsonData.online_amount;
					//myChart2.setOption(option2,true);
				}
		});
	}
  
  function initScatterplot(){
	  doManager("BusinessReportManager","queryDataOfScatterplot",[shareChartStatDto],
			function(data,textStatus,XmlHttpRequest){
				if (data.result) {
					var jsonData = $.fromJSON(data.data);
					if(jsonData.length!=0){
						$(jsonData).each(function(index,element){
							var temp = [];
							temp.push(element.order_count);
							temp.push((element.order_amount/10000).toFixed(2));
							temp.push(element.city_name);
							temp.push(element.store_name);
							temp.push(element.time);
							temp.push(element.storeno);
							temp.push(element.cityno);
							dataBJ.push(temp);
	                 	});
						option3.series[0].data = dataBJ;
						//myChart3.setOption(option3,true);
					}else{
						dataBJ = [];
						option3.series[0].data = dataBJ;
						//myChart3.setOption(option3,true);	
					}
				}
		});
  }
  
  function initalldept(){
	  doManager("BusinessReportManager","queryAllDept",null,
		    function(data,textStatus,XmlHttpRequest){
				if (data.result) {
					var jsonData = $.fromJSON(data.data);
					$("#deptSelect").append("<option value=''>全部事业群</option>");
					$("#deptSelectContrast").append("<option value=''>全部事业群</option>");
					$(jsonData).each(function(index,element){
						$("#deptSelect").append('<option value="'+element.id+'">'+element.name+'</option>');
						$("#deptSelectContrast").append('<option value="'+element.id+'">'+element.name+'</option>');
	                  });
				}
		});
  }
  
  var array_channel=new Array();
	//初始化所有频道
	function initallchannel() {
		doManager("BusinessReportManager", "queryAllChannel", null,
			function(data, textStatus, XMLHttpRequest) {
				if (data.result) {
					var jsonData = $.fromJSON(data.data);
					array_channel = new Array();
					var storeString = "";
					for(i=0;i<jsonData.length;i++){
						array_channel.push(jsonData[i].name);
						if(i == 0){
							storeString = "{'"+jsonData[i].name+"'"+":"+"'"+jsonData[i].id+"'"+",";
						}else if(i == jsonData.length-1){
							storeString = storeString+"'"+jsonData[i].name+"'"+":"+"'"+jsonData[i].id+"'"+"}";
						}else{
							storeString = storeString+"'"+jsonData[i].name+"'"+":"+"'"+jsonData[i].id+"'"+",";
						}
					}
					storeJson=$.fromJSON(storeString);
					$("#channelSelect").append("<option value=''>全部频道</option>");
					$(jsonData).each(function(index,element){
						$("#channelSelect").append('<option value="'+element.id+'">'+element.name+'</option>');
	                });
				}
			}, false);
	}
	
	$("#deptSelect").change(function(){
		initChannelSelectcomplate();
	});
	
	  var array_channel_contrast=new Array();
		//初始化所有频道
		function initallchannelcontrast() {
			doManager("BusinessReportManager", "queryAllChannel", null,
				function(data, textStatus, XMLHttpRequest) {
					if (data.result) {
						var jsonData = $.fromJSON(data.data);
						array_chnanel_contrast = new Array();
						var storeString = "";
						for(i=0;i<jsonData.length;i++){
							array_channel_contrast.push(jsonData[i].name);
							if(i == 0){
								storeString = "{'"+jsonData[i].name+"'"+":"+"'"+jsonData[i].id+"'"+",";
							}else if(i == jsonData.length-1){
								storeString = storeString+"'"+jsonData[i].name+"'"+":"+"'"+jsonData[i].id+"'"+"}";
							}else{
								storeString = storeString+"'"+jsonData[i].name+"'"+":"+"'"+jsonData[i].id+"'"+",";
							}
						}
						storeJson=$.fromJSON(storeString);
						var autoCompleteContrast = new AutoComplete("channel_name_manual_contrast","auto_channel_contrast",array_channel_contrast);
						$("#channelSelectContrast").append("<option value=''>全部频道</option>");
						$(jsonData).each(function(index,element){
							$("#channelSelectContrast").append('<option value="'+element.id+'">'+element.name+'</option>');
		                });
					}
				}, false);
		}
	
	$("#deptSelectContrast").change(function(){
		initChannelSelectcomplateContrast();
	});
	
	var storeJsonChannel;
	function initChannelSelectcomplate(){
		var deptSelect = $("#deptSelect  option:selected").val();
		$("#channelSelect").empty();
		if(deptSelect==""){
			initallchannel();
		}else{
			//根据事业群查询频道信息
			var deptId = "'"+deptSelect+"'";
			doManager("BusinessReportManager","findChannelByDept",[deptId],
			    function(data,textStatus,XmlHttpRequest){
					if (data.result) {
						var jsonData = $.fromJSON(data.data);
						array_channel=new Array();
						var storeString = "";
						$(jsonData).each(function(index,element){
							var channelName = element.name;
							var id = element.id;
							array_channel.push(channelName);
							if(index == 0){
	 							storeString = "{'"+channelName+"'"+":"+"'"+id+"'"+",";
	 						}else if(index == jsonData.length-1){
	 							storeString = storeString+"'"+channelName+"'"+":"+"'"+id+"'"+"}";
	 						}else{
	 							storeString = storeString+"'"+channelName+"'"+":"+"'"+id+"'"+",";
	 						}
						});
						storeJsonChannel=$.fromJSON(storeString);
						$("#channelSelect").append("<option value=''>全部频道</option>");
						$(jsonData).each(function(index,element){
							$("#channelSelect").append('<option value="'+element.id+'">'+element.name+'</option>');
		                });
					}
			});
		}
		
	}
	
	var storeJsonChannelContrast;
	function initChannelSelectcomplateContrast(){
		var deptSelect = $("#deptSelectContrast  option:selected").val();
		$("#channelSelectContrast").empty();
		if(deptSelect==""){
			initallchannelcontrast();
		}else{
			//根据事业群查询频道信息
			var deptId = "'"+deptSelect+"'";
			doManager("BusinessReportManager","findChannelByDept",[deptId],
			    function(data,textStatus,XmlHttpRequest){
					if (data.result) {
						var jsonData = $.fromJSON(data.data);
						array_channel_contrast=new Array();
						var storeString = "";
						$(jsonData).each(function(index,element){
							var channelName = element.name;
							var id = element.id;
							array_channel_contrast.push(channelName);
							if(index == 0){
	 							storeString = "{'"+channelName+"'"+":"+"'"+id+"'"+",";
	 						}else if(index == jsonData.length-1){
	 							storeString = storeString+"'"+channelName+"'"+":"+"'"+id+"'"+"}";
	 						}else{
	 							storeString = storeString+"'"+channelName+"'"+":"+"'"+id+"'"+",";
	 						}
						});
						storeJsonChannel=$.fromJSON(storeString);
						$("#channelSelectContrast").append("<option value=''>全部频道</option>");
						$(jsonData).each(function(index,element){
							$("#channelSelectContrast").append('<option value="'+element.id+'">'+element.name+'</option>');
		                });
					}
			});
		}
		
	}
  
  function initallcity(){
	   var effectiveCity = [];
	   doManager("BusinessReportManager","queryContainsStoreDistCityList",null,
		    function(data,textStatus,XmlHttpRequest){
				if (data.result) {
					var jsonData = $.fromJSON(data.data);
					$(jsonData).each(function(index,element){
						effectiveCity.push(element.cityname);
                   });
				}
		},false);
	  
		doManager("distCityCodeManager","queryAllDistCityList",null,
		    function(data,textStatus,XmlHttpRequest){
				if (data.result) {
					var jsonData = $.fromJSON(data.data);
					$("#citySelect").append("<option value=''>全部城市</option>");
					$("#citySelectContrast").append("<option value=''>全部城市</option>");
					$(jsonData).each(function(index,element){
						var indexTemp = jQuery.inArray(element.cityname,effectiveCity);
						if(indexTemp>=0){
							$("#citySelect").append('<option value="'+element.cityname+'">'+element.cityname+'</option>');
							$("#citySelectContrast").append('<option value="'+element.cityname+'">'+element.cityname+'</option>');
						}
                   });
				}
		});
	} 
   
  var array=new Array();
	//初始化所有门店 
	function initallstore() {
		doManager("StoreManager", "findStoreAll", null,
			function(data, textStatus, XMLHttpRequest) {
				if (data.result) {
					var jsonData = $.fromJSON(data.data);
					array = new Array();
					var storeString = "";
					for(i=0;i<jsonData.length;i++){
						array.push(jsonData[i].name);
						if(i == 0){
							storeString = "{'"+jsonData[i].name+"'"+":"+"'"+jsonData[i].storeno+"'"+",";
						}else if(i == jsonData.length-1){
							storeString = storeString+"'"+jsonData[i].name+"'"+":"+"'"+jsonData[i].storeno+"'"+"}";
						}else{
							storeString = storeString+"'"+jsonData[i].name+"'"+":"+"'"+jsonData[i].storeno+"'"+",";
						}
					}
					storeJson=$.fromJSON(storeString);
					var autoComplete = new AutoComplete("store_name_manual","auto",array);
					/* document.getElementById("store_name_manual").onkeyup = function(event){
						autoComplete.start(event);
						if($("#store_name_manual").val().trim() == ""){
							$("#store_id_manual").val("");
						}
						document.getElementById("store_name_manual").value=document.getElementById("store_name_manual").value.replace(/(\s*)|(\s*)/g,'').replace(/[ ]/g,'');
					} */
				}
			}, false);
	}
	
   function initcurcity(){
	   var effectiveCity = [];
	   doManager("BusinessReportManager","queryContainsStoreDistCityList",null,
		    function(data,textStatus,XmlHttpRequest){
				if (data.result) {
					var jsonData = $.fromJSON(data.data);
					$(jsonData).each(function(index,element){
						effectiveCity.push(element.cityname);
                   });
				}
		},false);
	   
		doManager("userManager","getCurrentUserCity",null,
		    function(data,textStatus,XmlHttpRequest){
				if (data.result) {
					var jsonData = $.fromJSON(data.data);
					$(jsonData).each(function(index,element){
						var indexTemp = jQuery.inArray(element.cityname,effectiveCity);
						if(indexTemp>=0){
							$("#citySelect").append('<option value="'+element.cityname+'">'+element.cityname+'</option>');
							$("#citySelectContrast").append('<option value="'+element.cityname+'">'+element.cityname+'</option>');
						}
                   });
					
				}
		},false);
	}
  
   $("#citySelect").change(function(){
		$("#store_id_manual").val("");
		$("#store_name_manual").val("");
		initStoreSelectcomplate();
	});
   
   var array_contrast=new Array();
 	//初始化所有门店 
 	function initallstorecontrast() {
 		doManager("StoreManager", "findStoreAll", null,
 			function(data, textStatus, XMLHttpRequest) {
 				if (data.result) {
 					var jsonData = $.fromJSON(data.data);
 					array_contrast = new Array();
 					var storeString = "";
 					for(i=0;i<jsonData.length;i++){
 						array_contrast.push(jsonData[i].name);
 						if(i == 0){
 							storeString = "{'"+jsonData[i].name+"'"+":"+"'"+jsonData[i].storeno+"'"+",";
 						}else if(i == jsonData.length-1){
 							storeString = storeString+"'"+jsonData[i].name+"'"+":"+"'"+jsonData[i].storeno+"'"+"}";
 						}else{
 							storeString = storeString+"'"+jsonData[i].name+"'"+":"+"'"+jsonData[i].storeno+"'"+",";
 						}
 					}
 					storeJson=$.fromJSON(storeString);
 					var autoCompleteContrast = new AutoComplete("store_name_manual_contrast","auto_contrast",array_contrast);
 					/* document.getElementById("store_name_manual_contrast").onkeyup = function(event){
 						autoCompleteContrast.start(event);
 						if($("#store_name_manual_contrast").val().trim() == ""){
 							$("#store_id_manual_contrast").val("");
 						}
 						document.getElementById("store_name_manual_contrast").value=document.getElementById("store_name_manual_contrast").value.replace(/(\s*)|(\s*)/g,'').replace(/[ ]/g,'');
 					} */
 				}
 			}, false);
 	}
   
   $("#citySelectContrast").change(function(){
		$("#store_id_manual_contrast").val("");
		$("#store_name_manual_contrast").val("");
		initStoreSelectcomplateContrast();
	});
	
   var storeJson;
	function initStoreSelectcomplate(){
		var citySelect = $("#citySelect  option:selected").val();
		$("#auto").val("");
		if(citySelect==""){
			initallstore();
		}else{
			//根据城市查询门店 信息
			var cityname = "'"+citySelect+"'";
			doManager("StoreManager","findStoreByCityData",[cityname],
			    function(data,textStatus,XmlHttpRequest){
					if (data.result) {
						var jsonData = $.fromJSON(data.data);
						array=new Array();
						var storeString = "";
						$(jsonData).each(function(index,element){
							var storeName = element.name;
							var storeid = element.storeno;
							array.push(storeName);
							if(index == 0){
	 							storeString = "{'"+storeName+"'"+":"+"'"+storeid+"'"+",";
	 						}else if(index == jsonData.length-1){
	 							storeString = storeString+"'"+storeName+"'"+":"+"'"+storeid+"'"+"}";
	 						}else{
	 							storeString = storeString+"'"+storeName+"'"+":"+"'"+storeid+"'"+",";
	 						}
						});
						storeJson=$.fromJSON(storeString);
						var autoCompleteName = new AutoComplete("store_name_manual","auto",array);
						/* document.getElementById("store_name_manual").onkeyup = function(event){
							autoCompleteName.start(event);
							if($("#store_name_manual").val().trim() == ""){
								$("#store_id_manual").val("");
							}
							document.getElementById("store_name_manual").value=document.getElementById("store_name_manual").value.replace(/(\s*)|(\s*)/g,'').replace(/[ ]/g,'');
						} */
					}
			});
		}
		
	}
	
	var storeJsonContrast;
	function initStoreSelectcomplateContrast(){
		var citySelect = $("#citySelectContrast  option:selected").val();
		$("#auto_contrast").val("");
		if(citySelect==""){
			initallstorecontrast();
		}else{
			//根据城市查询门店 信息
			var cityname = "'"+citySelect+"'";
			doManager("StoreManager","findStoreByCityData",[cityname],
			    function(data,textStatus,XmlHttpRequest){
					if (data.result) {
						var jsonData = $.fromJSON(data.data);
						array_contrast=new Array();
						var storeString = "";
						$(jsonData).each(function(index,element){
							var storeName = element.name;
							var storeid = element.storeno;
							array_contrast.push(storeName);
							if(index == 0){
	 							storeString = "{'"+storeName+"'"+":"+"'"+storeid+"'"+",";
	 						}else if(index == jsonData.length-1){
	 							storeString = storeString+"'"+storeName+"'"+":"+"'"+storeid+"'"+"}";
	 						}else{
	 							storeString = storeString+"'"+storeName+"'"+":"+"'"+storeid+"'"+",";
	 						}
						});
						storeJson=$.fromJSON(storeString);
						var autoCompleteName = new AutoComplete("store_name_manual_contrast","auto_contrast",array_contrast);
						/* document.getElementById("store_name_manual_contrast").onkeyup = function(event){
							autoCompleteName.start(event);
							if($("#store_name_manual_contrast").val().trim() == ""){
								$("#store_id_manual_contrast").val("");
							}
							document.getElementById("store_name_manual_contrast").value=document.getElementById("store_name_manual_contrast").value.replace(/(\s*)|(\s*)/g,'').replace(/[ ]/g,'');
						} */
					}
			});
		}
		
	}
  
	var iCheckStr = "cb";
	var iCheckMaxStr = "";
	function getShareParam(){
		 var cLabel=0;
		 var maxBLabel=0;
		 var smallBLabel=0;
		 if(iCheckStr=='cb') {
			 cLabel=1;
			 smallBLabel=1;
		 }
		 if(iCheckMaxStr=='maxb') {
			 maxBLabel=1;
		 }
		 var storeno = $("#store_id_manual").val()==""?null:$("#store_id_manual").val();
		  var cityName = $("#citySelect  option:selected").val();
		  if(cityName!="" && cityName!=undefined){
		    if(cityName=="黔东南苗族侗族自治州"){
		    	cityName="黔东南";
		  	}
		  }else{
		    cityName = null;
		  }
	      var deptname = $("#deptSelect option:selected").html()==""?null:$("#deptSelect option:selected").html();
	      if(deptname!="" && deptname=="全部事业群"){
	    	  deptname = null;
	      }
	      var channelname = $("#channelSelect option:selected").html()==""?null:$("#channelSelect option:selected").html();
	      if(channelname!="" && channelname=="全部频道"){
	    	  channelname = null;
	      }
		  
		  return shareChartStatDto = {				
				storeno:storeno_unique,
				cityname:cityName,
				deptname:deptname,
				channelname:channelname,
				cLabel:cLabel,
				maxBLabel:maxBLabel,
				smallBLabel:smallBLabel
			}
	}
	
	function getShareParamContrast(){
		 var storeno = $("#store_id_manual_contrast").val()==""?null:$("#store_id_manual_contrast").val();
		  var cityName = $("#citySelectContrast  option:selected").val();
		  if(cityName!="" && cityName!=undefined){
		    if(cityName=="黔东南苗族侗族自治州"){
		    	cityName="黔东南";
		  	}
		  }else{
		    cityName = null;
		  }
	      var deptname = $("#deptSelectContrast option:selected").html()==""?null:$("#deptSelectContrast option:selected").html();
	      if(deptname!="" && deptname=="全部事业群"){
	    	  deptname = null;
	      }
	      var channelname = $("#channelSelectContrast option:selected").html()==""?null:$("#channelSelectContrast option:selected").html();
	      if(channelname!="" && channelname=="全部频道"){
	    	  channelname = null;
	      }
		  
		  return shareChartStatDto = {
				storeno:storeno_unique,
				cityname:cityName,
				deptname:deptname,
				channelname:channelname
			}
	}
	
	//搜索
	function search_manual_k(){
		clearInterval(timeTicket);
		var deptName = $("#deptSelect  option:selected").text();
		
		//检测数据正确性
		var channelName = $("#channelSelect  option:selected").text();
		if(channelName!="" && channelName!="全部频道"){
	  	  	if($.inArray(channelName, array_channel) == -1){
				//crm_alert(0,"该频道不存在！");
				timeTicket = setInterval(loadtime, 5000);
				return;
			}
	    }
		
		var number_str = $("#store_id_manual").val(); 
  	    var storeName = $("#store_name_manual").val();
  	  	/* if(storeName!=""){
	  	  	if($.inArray(storeName, array) == -1){
				//crm_alert(0,"该门店不存在！");
				timeTicket = setInterval(loadtime, 5000);
				return;
			}
	    } */
  	    if(number_str==""&&storeName!=""){
	    	number_str=-10000;
	    }
		
		 $("#process_div").show();
	 	 $("#process_div_pic").show();
	 	 
	 	  
	 	  shareChartStatDto = getShareParam();
	 	  data = [];
		  initRealData();
		  //实时营业额
		  curDayGMV = 0.00;
		  inintCurDayData();
// 		  setInterval(inintCurDayData, 5000);
		  //当月营业额
		  curMonthData = 0.00;
		  initCurMonthData();
// 		  setInterval(initCurMonthData, 5000);
		  //分时GMV
		  hourData = [];
		  initHourData();
// 		  setInterval(initHourData, 5000);
		  //日GMV
   		  yData = [];
		  initDayData();
		  //周GMV
		  weekData = [];
		  initWeekData();
		  //月GMV
		  yData_month = [];
		  yData_month_target = [];
		  initMonthData();
		  //占比营业额
		  initOnlineOfflineTurnover();
		  //门店GMV散点分布
		  dataBJ = [];
		  initScatterplot();		  
    }
	
	function changeMoney (x) {
	    x=x/10000;
	    var y = '';
	    if(parseInt(x)/10000<=1){
	    	y=ForDight(x,2)+"万";
	    }else if(parseInt(x)/10000>1){
	    	x=x/10000+'';
	    	y=ForDight(x,2)+"亿";
	    }
	    return y;
	}
	function ForDight(str,How){  
	    Dight = Math.round(str*Math.pow(10,How))/Math.pow(10,How);  
	    return Dight;  
	 }
  //获取当前日期为今年的第几天
//   function getCurDay(){
// 	  var dateArr = new Array(31, 28, 31, 30, 31, 30, 31, 31, 30, 31, 30, 31);  
// 	  var date = new Date();  
// 	  var day = date.getDate();  
// 	  var month = date.getMonth(); //getMonth()是从0开始  
// 	  var year = date.getFullYear();  
// 	  var result = 0;  
// 	  for ( var i = 0; i < month; i++) {  
// 	      result += dateArr[i];  
// 	  }  
// 	  result += day;  
// 	  //判断是否闰年  
// 	  if (month > 1 && (year % 4 == 0 && year % 100 != 0) || year % 400 == 0) {  
// 	      result += 1;  
// 	  }  
// 	  return result;
//   }
  
  //获取当年第一天
  function getFirstDayOfYear() {
	 var nowTime = new Date();
	 nowTime.setDate(1);
	 nowTime.setMonth(0);
     return timeFormat(nowTime);
  }
   //日期格式化，返回值形式为yy-mm-dd
   function timeFormat(date) {
       if (!date || typeof(date) === "string") {
           this.error("参数异常，请检查...");
      }
      var y = date.getFullYear(); //年
      var m = date.getMonth() + 1; //月
      var d = date.getDate(); //日
      return y + "-" + m + "-" + d;
   }
  //获取两个时间段内的月份数据
  function getYearAndMonth(start, end) {
	    var result = [];
	    var starts = start.split('-');
	    var ends = end.split('-');
	    var staYear = parseInt(starts[0]);
	    var staMon = parseInt(starts[1]);
	    var endYear = parseInt(ends[0]);
	    var endMon = parseInt(ends[1]);
	    while (staYear <= endYear) {
	        if (staYear === endYear) {
	            while (staMon < endMon) {
	                staMon++;
	                result.push(staYear+"-"+staMon);
	            }
	            staYear++;
	        } else {
	            staMon++;
	            if (staMon > 12) {
	                staMon = 1;
	                staYear++;
	            }
	            result.push(staYear+"-"+staMon);
	        }
	    }
	    return result;
	}
  
  //获取当年所有的日期
  function getAllDate(begin, end) {  
	  var result = [];
      var ab = begin.split("-");  
      var ae = end.split("-");  
      var db = new Date();  
      db.setUTCFullYear(ab[0], ab[1] - 1, ab[2]);  
      var de = new Date();  
      de.setUTCFullYear(ae[0], ae[1] - 1, ae[2]);  
      var unixDb = db.getTime();  
      var unixDe = de.getTime();  
      for (var k = unixDb; k <= unixDe;) {  
          result.push((new Date(parseInt(k))).format());
          k = k + 24 * 60 * 60 * 1000;  
      }  
      return result;
  } 
  
  function excuteRefresh(){
	  location.reload();
  }
  function toBussiness(){
	  var url = "";
	  if(target==0){
		  	url = "index_K_221.html?t="+encode64('0')+"&s=&sn=&c=&cn=&so="+encode64(storeNo_)+"&ordertype="+encode64(ordertype)+"&store_name="+encode64(storeName_);
		  }else if(target==1){
		  	url = "index_K_221.html?t="+encode64(1)+"&s=&sn=&c=cn=&so="+encode64(storeNo_)+"&ordertype="+encode64(ordertype)+"&store_name="+encode64(storeName_);
		  }
 		window.location.href=url;
  }
    function doK_Mem(){
        var url = "";
        if(target==0){
            url = "index_K_member.html?t="+encode64(target)+"&c=&cn=&so="+encode64(storeNo_)+"&ordertype="+encode64(ordertype)+"&store_name="+encode64(storeName_)+"&e=";
        }else if(target==1){
            url = "index_K_member.html?t="+encode64(1)+"&s=&c="+ encode64(cityId)+"&so="+encode64(storeNo_)+"&ordertype="+encode64(ordertype)+"&store_name="+encode64(storeName_)+"&cn="+encode64(cityName)+"&e=";
        }else{
            url = "index_K_member.html?t="+encode64(0);
        }
        window.location.href=url;
    }
</script>
<script>
	$(function () {
    	//判断是否多个门店 发生切换变化 
    	if(!checkStoreChange()){
    		return;
    	}
        $$.executeSearch('queryrecommenduserlist', 'conditionsDiv');
        $("#cstmz_actv").remove();
        $(".display").css("width","auto");
	});
</script>
<style type="text/css">
    .but {
        float: right;
        text-align: center;
    }
    .but input{background-color:transparent; border:1px solid #fff; border-radius:3px; padding:0 13px; margin-right:30px;}
	.auto{max-height:100px; overflow-y:scroll;}
	
</style>
<body class="hold-transition skin-blue sidebar-mini">

 	<div id="header">
		<div id="sitename">
			<a href="index.html" class="logo float-left" title="国安社区门店管理系统">国安社区门店管理系统</a>
			<div class="button float-right" id="top-menu">
			<!--	<a href="#" id="dialog_link" class="btn ui-state-default ui-corner-all"><span class="ui-icon ui-icon-newwin"></span>打开对话框</a>
				<a href="#" id="login_dialog" class="btn ui-state-default ui-corner-all"><span class="ui-icon ui-icon-image"></span>登录框</a>  -->
              <span id="userName"></span>
              <!-- | <a href="#" title="Edit profile">编辑资料</a> -->
              <!-- | <a href="javascript:doLogout()" title="Logout">退出</a> -->
			</div>
			<div id="login" title="退出" style="min-height: 35px; width: auto;">
					<ul>
						<li>
							确定退出国安社区门店管理系统？
						</li>
					</ul>
			</div>
		</div>
		<ul id="navigation" class="sf-navbar">
				<!-- <li>
						<a>运营日报</a>
				</li> -->
		</ul>
	</div>

<div class="wrapper">
	<div id="page">
	  <div class="content-wrapper" style="min-height: 408px;">
            <div class="container" style="width: 1300px;">
            		<div class="content-header">
            				<div class="box box-default report" style="display:none;">
            						    <div class="container">
												<div class="row">
													<div class="col-md-3">
														<table>
															<tr><th colspan="4">订单量</th></tr>
															<tr><td>昨日：</td><td>30%</td><td>环比增长：</td><td>30%</td></tr>
															<tr><td>上月：</td><td>30%</td><td>环比增长：</td><td>30%</td></tr>
															<tr><td>累计：</td><td>30%</td><td>月均增长：</td><td>30%</td></tr>
														</table>
													</div>
													<div class="col-md-3">
														<table>
															<tr><th colspan="4">订单金额</th></tr>
															<tr><td>昨日：</td><td>30%</td><td>环比增长：</td><td>30%</td></tr>
															<tr><td>上月：</td><td>30%</td><td>环比增长：</td><td>30%</td></tr>
															<tr><td>累计：</td><td>30%</td><td>月均增长：</td><td>30%</td></tr>
														</table>
													</div>
													<div class="col-md-3">
														<table>
															<tr><th colspan="4">新增下单用户数</th></tr>
															<tr><td>昨日：</td><td>30%</td><td>环比增长：</td><td>30%</td></tr>
															<tr><td>上月：</td><td>30%</td><td>环比增长：</td><td>30%</td></tr>
															<tr><td>累计：</td><td>30%</td><td>月均增长：</td><td>30%</td></tr>
														</table>
													</div>
													<div class="col-md-3">
														<table>
															<tr><th colspan="4">下单用户数</th></tr>
															<tr><td>昨日：</td><td>30%</td><td>环比增长：</td><td>30%</td></tr>
															<tr><td>上月：</td><td>30%</td><td>环比增长：</td><td>30%</td></tr>
															<tr><td>累计：</td><td>30%</td><td>月均增长：</td><td>30%</td></tr>
														</table>
													</div>
												</div>
												<div class="row">
													<div class="col-md-3">
														<table>
															<tr><th colspan="4">订单量排行榜</th></tr>
															<tr><th></th><th>本区</th><th>本市</th><th>全国</th></tr>
															<tr><td>昨日：</td><td>30%</td><td>环比增长：</td><td>30%</td></tr>
															<tr><td>上月：</td><td>30%</td><td>环比增长：</td><td>30%</td></tr>
															<tr><td>累计：</td><td>30%</td><td>月均增长：</td><td>30%</td></tr>
														</table>
													</div>
													<div class="col-md-3">
														<table>
															<tr><th colspan="4">订单量排行榜</th></tr>
															<tr><th></th><th>本区</th><th>本市</th><th>全国</th></tr>
															<tr><td>昨日：</td><td>30%</td><td>环比增长：</td><td>30%</td></tr>
															<tr><td>上月：</td><td>30%</td><td>环比增长：</td><td>30%</td></tr>
															<tr><td>累计：</td><td>30%</td><td>月均增长：</td><td>30%</td></tr>
														</table>
													</div>
													<div class="col-md-3">
														<table>
															<tr><th colspan="4">订单量排行榜</th></tr>
															<tr><th></th><th>本区</th><th>本市</th><th>全国</th></tr>
															<tr><td>昨日：</td><td>30%</td><td>环比增长：</td><td>30%</td></tr>
															<tr><td>上月：</td><td>30%</td><td>环比增长：</td><td>30%</td></tr>
															<tr><td>累计：</td><td>30%</td><td>月均增长：</td><td>30%</td></tr>
														</table>
													</div>
													<div class="col-md-3">
														<table>
															<tr><th colspan="4">订单量排行榜</th></tr>
															<tr><th></th><th>本区</th><th>本市</th><th>全国</th></tr>
															<tr><td>昨日：</td><td>30%</td><td>环比增长：</td><td>30%</td></tr>
															<tr><td>上月：</td><td>30%</td><td>环比增长：</td><td>30%</td></tr>
															<tr><td>累计：</td><td>30%</td><td>月均增长：</td><td>30%</td></tr>
														</table>
													</div>
												</div>
											</div>
            								
            				</div>
            				<div class="box box-default">
            						<div style="margin:0;border:0;padding:0">
											<div class="nav_l" id="nav_l">
												  <!-- Tabs within a box -->
												  <ul class="nav nav-tabs no-border nav-tabs1">
									<!-- 				<li class="active"><a href="#revenue-chart" data-toggle="tab">实时</a></li> -->
													<!-- <li><a href="#sales-chart" data-toggle="tab" onclick="javascript:chartresize1()">时</a></li> -->
									                <li><a href="#day-chart" data-toggle="tab" onclick="javascript:chartresize2()">日</a></li>
													<!-- <li><a href="#week-chart" data-toggle="tab" onclick="javascript:chartresize4()">周</a></li>
									                <li  class="active"><a href="#month-chart" data-toggle="tab" onclick="javascript:chartresize3()">月</a></li> -->
									                <!-- <div class="col-sm-1 pull-right"><button type="button" id="search-btn-add" class="btn btn-block btn-sm" style="margin-right: 50px; font-size: 14px; background-color: rgba(0,0,0,0.1);color: #fff">加入对比</button></div> -->
												  </ul>
												  <div class="tab-content no-padding" id="tab-content">
													<!-- Morris chart - Sales -->
									<!-- 				<div class="chart tab-pane active" id="revenue-chart"> -->
									<!-- 				  <div id="main1" style="width: 100%; height: 300px;"></div> -->
									<!-- 				</div> -->
													<div class="chart tab-pane" id="sales-chart">
													  <div id="main4" style="width: 100%; height: 411px;"></div>
													</div>
									                <div class="chart tab-pane active" id="day-chart">
									                  <div id="main5" style="width: 100%; height: 411px;"></div>
									                </div>
													<div class="chart tab-pane" id="week-chart">
													  <div id="main7" style="width: 100%; height: 411px;"></div>
													</div>
									                <div class="chart tab-pane" id="month-chart">
									                  <div id="main6" style="width: 100%; height: 411px;"></div>
									                </div>
												  </div>
											</div>
									</div>		
            				</div>
            				<div class="box box-default">
            					<!-- <iframe id="i2ui_shell_top3" name="i2ui_shell_top3" src="../data_access/user_recommend.html" style="width: 100%;height: 400px;"></iframe> -->
            					<div class="panel-body" id="imp_data_div"> 
							            <div id="conditionsDiv" style="margin-top: 0px;display:none;">
							                <form id="service_qa" name="service_qa" class="pmsForm" validate="true" clientvalidate="true" displaynumber="7">
							                  <table id="searchTable" cellpadding="0" cellspacing="0" style="min-width: 100%; width: auto">
							                    <tr>
							                      <td width="33.33%">
							                        <p>员工姓名</p>
							                        <p><input id="platformid" name="platformid" type="text" style="width:80%" class="form-control" onkeyup="value=value.replace(/(\s*)|(\s*)/g,'').replace(/[ ]/g,'')"/></p>
							                      </td>
							                    </tr>
							                  </table>
							                </form>
							            </div> 
        						</div>
            					<div id="centerQueryGridContainer" class="panel panel-primary" queryid="queryrecommenduserlist" operators="$pmspage.opArr" titleAlign="center" fnRender="renderColumns" searchDiv="conditionsDiv" showno="false" showsearch="false" showpaging="true" showdisplay="false" showprint="false" autoload="false" showcheckbox="false" showRidaoButton="true" usecache="true" showsearch="false" showtitle="true"></div>
            			</div>
            		</div>
            </div>
      </div>
	</div>
</div>		
<script type="text/javascript">
		autodivheight();
		function autodivheight(){ //函数：获取尺寸
			//获取浏览器窗口高度
			var winHeight=0;
			if (window.innerHeight)
			  winHeight = window.innerHeight;
			else if ((document.body) && (document.body.clientHeight))
			  winHeight = document.body.clientHeight;
			//通过深入Document内部对body进行检测，获取浏览器窗口高度
			if (document.documentElement && document.documentElement.clientHeight)
			  winHeight = document.documentElement.clientHeight;
			//DIV高度为浏览器窗口的高度
			 document.getElementById("main4").style.height= winHeight/2 - 60  +"px";
			document.getElementById("main5").style.height= winHeight/2 - 60  +"px";
			document.getElementById("main6").style.height= winHeight/2 - 60  +"px";
			document.getElementById("main7").style.height= winHeight/2 - 60  +"px"; 
		}
		window.onresize=autodivheight; //浏览器窗口发生变化时同时变化DIV高度
</script>
</body>
</html>
